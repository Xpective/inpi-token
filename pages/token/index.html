<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>INPI Presale</title>

  
  <!-- CSP: nur self + jsDelivr für IIFE-Libs -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    connect-src 'self' https://inpinity.online;
    img-src 'self' data:;
    style-src 'self' 'unsafe-inline';
    script-src 'self' https://cdn.jsdelivr.net;
    frame-ancestors 'none';
    base-uri 'self';
    form-action 'self';
    img-src 'self' data: https://api.qrserver.com;
  ">

  <link rel="stylesheet" href="./styles.css?v=1"/>
  <script>
    // kleiner Cache-Buster
    window.__INPI_VER__ = "v" + Date.now();
  </script>
</head>
<body>
  <main>
    <header class="row" style="justify-content:space-between">
      <h1>INPI Presale</h1>
      <div class="row">
        <button id="btnHow" class="secondary">Anleitung</button>
        <button id="btnConnect">Wallet…</button>
      </div>
    </header>

    <section class="card">
      <div class="grid">
        <div><div class="muted">Wallet</div><div id="waddr">—</div></div>
        <div><div class="muted">Status</div><div id="st">—</div></div>
        <div><div class="muted">TGE</div><div id="tge">—</div></div>
      </div>
    </section>

    <section class="card">
      <h2>Kaufen</h2>
      <div><b>Preis:</b> <span id="price">—</span> <span id="gateBadge" class="muted"></span></div>
      <div class="grid" style="margin-top:8px">
        <div>
          <label class="muted">Betrag <small>(Eingabe)</small></label>
          <div class="row">
            <input id="amt" type="number" step="0.000001" min="0" placeholder="z.B. 25"/>
            <select id="mode">
              <option value="USDC">USDC</option>
              <option value="INPI">INPI</option>
            </select>
          </div>
          <small class="muted">Erwartung: <span id="exp">–</span></small>
        </div>
        <div class="col">
          <button id="btnIntent">QR erzeugen</button>
          <small id="msg" class="muted"></small>
        </div>
      </div>

      <div id="payRow" class="row" style="margin-top:10px;display:none">
        <canvas id="qr" class="qr" width="240" height="240"></canvas>
        <div class="col" style="min-width:260px">
          <div class="muted">USDC-ATA: <span id="ata">—</span></div>
          <small class="muted">Owner: <span id="owner">—</span></small>
        </div>
      </div>
    </section>

    <section id="early" class="card" style="display:none">
      <h2>Early-Claim</h2>
      <p class="muted">Sofortige Gutschrift gegen 1 USDC Fee.</p>
      <div class="row">
        <button id="btnEarly">QR für 1 USDC</button>
        <small id="emsg" class="muted"></small>
      </div>
      <div id="earRow" class="row" style="display:none;margin-top:10px">
        <canvas id="qrEarly" class="qr" width="240" height="240"></canvas>
        <div class="col" style="min-width:260px">
          <div class="muted">Erwartete Gutschrift: <span id="earlyExp">–</span></div>
          <label class="muted">Fee-TX Signatur</label>
          <input id="feeSig" placeholder="Transaktions-Signatur"/>
          <button id="btnConfirm">Bestätigen</button>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Tokenomics</h2>
      <div class="grid">
        <div><b>Total Supply:</b> <span id="tot">—</span></div>
        <div><b>Presale-Allocation:</b> <span id="pres">—</span></div>
      </div>
      <div style="overflow:auto;margin-top:8px">
        <table>
          <thead><tr><th>Bucket</th><th>BPS</th><th>%</th><th>INPI</th></tr></thead>
          <tbody id="trows"></tbody>
        </table>
      </div>
    </section>

    <section class="card">
      <h2>NFT Links</h2>
      <p class="muted">Gate-NFT &amp; Token auf Explorer/Marktplätzen:</p>
      <div class="row">
        <a id="lnTensor"  target="_blank" rel="noopener">Tensor (NFT)</a>
        <a id="lnME"      target="_blank" rel="noopener">Magic Eden (NFT)</a>
        <a id="lnInpiSS"  target="_blank" rel="noopener">Solscan (INPI)</a>
        <a id="lnUsdcSS"  target="_blank" rel="noopener">Solscan (USDC)</a>
      </div>
    </section>
  </main>

  <!-- IIFE libs -->
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.98.4/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <script src="./app.js?v=1" defer></script>
</body>
</html>