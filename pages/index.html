<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inpinity Token Presale</title>

  <!-- CSP: nur eigene Domain + API-Proxy + jsDelivr für IIFE-Libs -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    connect-src 'self' https://inpinity.online;
    img-src 'self' data:;
    style-src 'self' 'unsafe-inline';
    script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline';
    frame-ancestors 'none';
    base-uri 'self';
    form-action 'self';
  ">

  <!-- Caching strikt reduzieren (Frontend wird zusätzlich mit ?v= gebustet) -->
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    :root{color-scheme:dark light}
    body{margin:0;font:16px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#0d1622;color:#e8f0ff}
    a{color:#7cc4ff} a:hover{opacity:.85}
    main{max-width:920px;margin:24px auto;padding:0 16px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin:6px 0 18px}
    .row{display:flex;gap:.75rem;align-items:center}
    .col{display:flex;flex-direction:column}
    .card{background:#0f1b2a;border:1px solid #1c2836;border-radius:12px;padding:16px}
    .muted{color:#9db3c7}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;background:#0b1420;border:1px solid #1a2231;border-radius:6px;padding:.1rem .35rem}
    button{background:#1b2a40;color:#e8f0ff;border:1px solid #2a3d57;border-radius:10px;padding:.55rem .9rem;cursor:pointer}
    button[disabled]{opacity:.6;cursor:not-allowed}
    input,select{background:#0b1420;color:#e8f0ff;border:1px solid #1a2231;border-radius:8px;padding:.5rem .6rem}
    label{display:block;margin:.3rem 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
    .qr{display:block;width:240px;height:240px;border-radius:8px;background:#061120;border:1px dashed #223148}
    small.muted{font-size:.9em}
  </style>

  <!-- Versionsbump: bei Deploy NUR diese Konstante ändern (oder Date.now() für hartes Busting) -->
  <script>
    (function(){
      // Beispiel: Buildnummer/Datum → beim nächsten Deploy erhöhen
      const VER = "v1.0.0-frontend-idx-2025-08-29-01";
      window.__INPI_VER__ = VER;

      // Falls du die IIFE-CDNs schon im Head vorladen willst (optional):
      const preload = [
        "https://cdn.jsdelivr.net/npm/@solana/web3.js@1.98.4/lib/index.iife.min.js",
        "https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"
      ];
      preload.forEach(src=>{
        const l=document.createElement("link");
        l.rel="preload"; l.as="script"; l.href=src;
        document.head.appendChild(l);
      });

      // app.js mit ?v= laden (Cache-Buster)
      const s=document.createElement("script");
      s.src = "./app.js" + (/\?/.test("./app.js") ? "&" : "?") + "v=" + encodeURIComponent(VER);
      s.defer = true;
      document.head.appendChild(s);

      // Optional: auch eine lokale CSS-Datei busten (falls vorhanden)
      // const css = document.createElement("link");
      // css.rel = "stylesheet";
      // css.href = "./styles.css?v=" + encodeURIComponent(VER);
      // document.head.appendChild(css);
    })();
  </script>
</head>
<body>
  <main>
    <header>
      <div class="row">
        <h1 style="margin:0;font-size:1.25rem">INPI Presale</h1>
        <span class="kbd" title="Frontend Build-Version">Front: <span id="verTxt"></span></span>
      </div>
      <div class="row">
        <button id="btnHowTo" type="button">Anleitung</button>
        <button id="btnConnect" type="button" disabled>Wallet…</button>
      </div>
    </header>

    <section class="card">
      <div class="grid">
        <div>
          <div class="muted">Wallet</div>
          <div id="walletAddr">—</div>
        </div>
        <div>
          <div class="muted">Presale-Status</div>
          <div id="presaleState">—</div>
        </div>
        <div>
          <div class="muted">TGE Countdown</div>
          <div id="tgeTime">—</div>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:12px">
      <h2 style="margin-top:0">Kauf</h2>

      <div class="row" style="flex-wrap:wrap">
        <div><b>Preis:</b> <span id="p0">—</span></div>
      </div>

      <div class="grid" style="margin-top:10px">
        <div>
          <label>
            Betrag
            <input id="inpAmount" type="number" step="0.000001" min="0" placeholder="z.B. 25" />
          </label>
          <small class="muted">Erwartung: <span id="expectedInpi">–</span></small>
        </div>

        <div class="col">
          <div class="row" style="gap:.5rem;flex-wrap:wrap">
            <button id="btnPresaleIntent" type="button">Intent & QR erzeugen</button>
          </div>
          <div id="intentMsg" class="col" style="margin-top:.5rem"></div>
        </div>
      </div>

      <div id="payArea" class="row" style="margin-top:12px;gap:16px;display:none">
        <img id="inpi-qr" class="qr" alt="Scan & pay USDC (Solana Pay)" />
        <div class="col">
          <div class="muted">USDC-Deposit (ATA): <span id="depositAddr">—</span></div>
          <div class="row" style="gap:.5rem">
            <a id="depositSolscan" href="#" target="_blank" rel="noopener" style="display:none">Solscan</a>
            <button id="btnCopyDeposit" type="button">Kopieren</button>
          </div>
          <small class="muted" style="margin-top:.5rem">Owner: <span id="depositOwner">—</span></small>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:12px">
      <h2 style="margin-top:0">Wallet-Balances</h2>
      <div class="grid">
        <div><b>USDC:</b> <span id="usdcBal">—</span></div>
        <div><b>INPI:</b> <span id="inpiBal">—</span></div>
      </div>
    </section>

    <section id="earlyBox" class="card" style="margin-top:12px;display:none">
      <h2 style="margin-top:0">Early-Claim</h2>
      <p class="muted">Sofortige Gutschrift gegen 1&nbsp;USDC Fee.</p>
      <div class="row" style="gap:.75rem;flex-wrap:wrap">
        <button id="btnClaim" type="button">Early-QR erzeugen</button>
        <span id="earlyMsg" class="muted"></span>
      </div>

      <div id="earlyArea" class="row" style="gap:16px;align-items:flex-start;display:none;margin-top:.5rem">
        <img id="early-qr" class="qr" alt="Scan & pay Early Fee" />
        <div class="col" style="min-width:260px">
          <div class="muted">Erwartete sofortige Gutschrift: <span id="earlyExpected">–</span></div>
          <label>Fee-Signatur
            <input id="earlySig" type="text" placeholder="Transaktions-Signatur" />
          </label>
          <button id="btnEarlyConfirm" type="button">Bestätigen</button>
        </div>
      </div>
    </section>

    <!-- Tokenomics-Section wird von app.js dynamisch eingefügt -->
  </main>

  <script>
    // Anzeige der Build-Version oben rechts
    (function(){
      const t=document.getElementById("verTxt");
      if (t) t.textContent = window.__INPI_VER__ || "dev";
    })();
  </script>
</body>
</html>